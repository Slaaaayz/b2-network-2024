# TP2 : Environnement virtuel
## I. Topologie réseau
**☀️ Sur node1.lan1.tp2**
```
[slayz@node1lan1 ~]$ ip a
1: lo: <LOOPBACK,UP,LOWER_UP> mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1000
    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00
    inet 127.0.0.1/8 scope host lo
       valid_lft forever preferred_lft forever
    inet6 ::1/128 scope host
       valid_lft forever preferred_lft forever
2: enp0s3: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc fq_codel state UP group default qlen 1000
    link/ether 08:00:27:db:ac:e3 brd ff:ff:ff:ff:ff:ff
    inet 10.1.1.11/24 brd 10.1.1.255 scope global noprefixroute enp0s3
       valid_lft forever preferred_lft forever
    inet6 fe80::a00:27ff:fedb:ace3/64 scope link
       valid_lft forever preferred_lft forever

[slayz@node1lan1 ~]$ ip r s
default via 10.1.2.254 dev enp0s3 proto static metric 100
10.1.1.0/24 dev enp0s3 proto kernel scope link src 10.1.1.11 metric 100
10.1.2.254 dev enp0s3 proto static scope link metric 100

[slayz@node1lan1 ~]$ ping 10.1.2.12
PING 10.1.2.12 (10.1.2.12) 56(84) bytes of data.
64 bytes from 10.1.2.12: icmp_seq=1 ttl=63 time=3.13 ms
64 bytes from 10.1.2.12: icmp_seq=2 ttl=63 time=2.93 ms
64 bytes from 10.1.2.12: icmp_seq=3 ttl=63 time=2.89 ms
^C
--- 10.1.2.12 ping statistics ---
3 packets transmitted, 3 received, 0% packet loss, time 2006ms
rtt min/avg/max/mdev = 2.885/2.981/3.129/0.106 ms
[slayz@node1lan1 ~]$ traceroute 10.1.2.254
traceroute to 10.1.2.254 (10.1.2.254), 30 hops max, 60 byte packets
 1  _gateway (10.1.2.254)  2.703 ms !X  2.391 ms !X  2.363 ms !X
```

## II. Interlude accès internet
**☀️ Sur router.tp2**
```
[slayz@router ~]$ ping 82.67.62.84
PING 82.67.62.84 (82.67.62.84) 56(84) bytes of data.
64 bytes from 82.67.62.84: icmp_seq=1 ttl=56 time=41.7 ms
64 bytes from 82.67.62.84: icmp_seq=2 ttl=56 time=61.9 ms
^C
--- 82.67.62.84 ping statistics ---
2 packets transmitted, 2 received, 0% packet loss, time 1003ms
rtt min/avg/max/mdev = 41.678/51.777/61.877/10.099 ms

[slayz@router ~]$ ping slayz.fr
PING slayz.fr (82.67.64.82) 56(84) bytes of data.
64 bytes from mut38-1_migr-82-67-64-82.fbx.proxad.net (82.67.64.82): icmp_seq=1 ttl=56 time=20.6 ms
64 bytes from mut38-1_migr-82-67-64-82.fbx.proxad.net (82.67.64.82): icmp_seq=2 ttl=56 time=40.0 ms
^C
--- slayz.fr ping statistics ---
2 packets transmitted, 2 received, 0% packet loss, time 1002ms
rtt min/avg/max/mdev = 20.619/30.301/39.984/9.682 ms
```
**☀️ Accès internet LAN1 et LAN2**
```
[slayz@node2lan1 ~]$ cat /etc/sysconfig/network-scripts/route-enp0s3
default via 10.1.2.254 dev enp0s3

[slayz@node2lan1 ~]$ cat /etc/resolv.conf
# Generated by NetworkManager
nameserver 1.1.1.1

[slayz@node2lan1 ~]$ ping 82.67.64.82
PING 82.67.64.82 (82.67.64.82) 56(84) bytes of data.
64 bytes from 82.67.64.82: icmp_seq=1 ttl=55 time=69.6 ms
64 bytes from 82.67.64.82: icmp_seq=2 ttl=55 time=27.7 ms
^C
--- 82.67.64.82 ping statistics ---
2 packets transmitted, 2 received, 0% packet loss, time 1003ms
rtt min/avg/max/mdev = 27.736/48.685/69.634/20.949 ms

[slayz@node2lan1 ~]$ ping slayz.fr
PING slayz.fr (82.67.64.82) 56(84) bytes of data.
64 bytes from mut38-1_migr-82-67-64-82.fbx.proxad.net (82.67.64.82): icmp_seq=1 ttl=55 time=30.4 ms
64 bytes from mut38-1_migr-82-67-64-82.fbx.proxad.net (82.67.64.82): icmp_seq=2 ttl=55 time=42.8 ms
^C
--- slayz.fr ping statistics ---
2 packets transmitted, 2 received, 0% packet loss, time 1001ms
rtt min/avg/max/mdev = 30.400/36.579/42.758/6.179 ms

```

## III. Services réseau
### 1. Web web web
**☀️ Sur web.lan2.tp2**

```
[slayz@weblan2 ~]$ sudo dnf -y install nginx
[slayz@weblan2 var]$ sudo nano /var/www/site_nul/index.html
<h1>Test <3</h1>

[slayz@weblan2 ~]$ sudo nano /etc/nginx/conf.d/site_nul.conf
```
[Voir la conf nginx](/TP2/site_nul.conf)
```
[slayz@weblan2 ~]$ sudo systemctl start nginx
[slayz@weblan2 ~]$ sudo systemctl enable nginx

[slayz@weblan2 var]$ sudo firewall-cmd --add-port=80/tcp --permanent
[slayz@weblan2 var]$ sudo firewall-cmd --reload

[slayz@weblan2 site_nul]$ ss -alntupe | grep 80
tcp   LISTEN 0      511          0.0.0.0:80        0.0.0.0:*    ino:23440 sk:4 cgroup:/system.slice/nginx.service <->
tcp   LISTEN 0      511             [::]:80           [::]:*    ino:23441 sk:6 cgroup:/system.slice/nginx.service v6only:1 <->

[slayz@weblan2 ~]$ sudo firewall-cmd --list-all
[sudo] password for slayz:
public (active)
  target: default
  icmp-block-inversion: no
  interfaces: enp0s3
  sources:
  services: cockpit dhcpv6-client ssh
  ports: 80/tcp
  protocols:
  forward: yes
  masquerade: no
  forward-ports:
  source-ports:
  icmp-blocks:
  rich rules:
```

**☀️ Sur node1.lan1.tp2**
```
[slayz@node1lan1 ~]$ sudo cat /etc/hosts
127.0.0.1   localhost localhost.localdomain localhost4 localhost4.localdomain4
::1         localhost localhost.localdomain localhost6 localhost6.localdomain6
10.1.2.12 site_nul.tp2

[slayz@node1lan1 ~]$ curl site_nul.tp2
<h1>Test <3</h1>
```

### 2. Or is it ? Bonus : DHCP
**☀️ Sur dhcp.lan1.tp2**
```
[slayz@dhcplan1 ~]$ sudo dnf -y install dhcp-server

[slayz@dhcplan1 ~]$ sudo cat /etc/dhcp/dhcpd.conf
[sudo] password for slayz:
# specify domain name
option domain-name     "srv.world";
# specify DNS server's hostname or IP address
option domain-name-servers     1.1.1.1;
# default lease time
default-lease-time 600;
# max lease time
max-lease-time 7200;
# this DHCP server to be declared valid
authoritative;
# specify network address and subnetmask
subnet 10.1.1.0 netmask 255.255.255.0 {
    # specify the range of lease IP address
    range dynamic-bootp 10.1.1.100 10.1.1.200;
    # specify broadcast address
    option broadcast-address 10.1.1.255;
    # specify gateway
    option routers 10.1.1.254;
}

[slayz@dhcplan1 ~]$ sudo systemctl status dhcpd
● dhcpd.service - DHCPv4 Server Daemon
     Loaded: loaded (/usr/lib/systemd/system/dhcpd.service; enabled; preset: disabled)
     Active: active (running) since Thu 2024-10-03 17:53:00 CEST; 13h ago
       Docs: man:dhcpd(8)
             man:dhcpd.conf(5)
   Main PID: 1643 (dhcpd)
     Status: "Dispatching packets..."
      Tasks: 1 (limit: 4665)
     Memory: 4.6M
        CPU: 77ms
     CGroup: /system.slice/dhcpd.service
             └─1643 /usr/sbin/dhcpd -f -cf /etc/dhcp/dhcpd.conf -user dhcpd -group dhcpd --no-pid

Oct 04 07:03:52 dhcplan1.tp2 dhcpd[1643]: DHCPACK on 10.1.1.100 to 08:00:27:db:ac:e3 (node1lan1) via enp0s3
Oct 04 07:03:54 dhcplan1.tp2 dhcpd[1643]: reuse_lease: lease age 49 (secs) under 25% threshold, reply with unaltered, existing lease for 10.1.1.101
Oct 04 07:03:54 dhcplan1.tp2 dhcpd[1643]: DHCPREQUEST for 10.1.1.101 from 08:00:27:db:ac:e3 via enp0s3
Oct 04 07:03:54 dhcplan1.tp2 dhcpd[1643]: DHCPACK on 10.1.1.101 to 08:00:27:db:ac:e3 via enp0s3
Oct 04 07:03:55 dhcplan1.tp2 dhcpd[1643]: reuse_lease: lease age 50 (secs) under 25% threshold, reply with unaltered, existing lease for 10.1.1.101
Oct 04 07:03:55 dhcplan1.tp2 dhcpd[1643]: DHCPDISCOVER from 08:00:27:db:ac:e3 via enp0s3
Oct 04 07:03:55 dhcplan1.tp2 dhcpd[1643]: DHCPOFFER on 10.1.1.101 to 08:00:27:db:ac:e3 via enp0s3
Oct 04 07:03:55 dhcplan1.tp2 dhcpd[1643]: reuse_lease: lease age 50 (secs) under 25% threshold, reply with unaltered, existing lease for 10.1.1.101
Oct 04 07:03:55 dhcplan1.tp2 dhcpd[1643]: DHCPREQUEST for 10.1.1.101 (10.1.1.253) from 08:00:27:db:ac:e3 via enp0s3
Oct 04 07:03:55 dhcplan1.tp2 dhcpd[1643]: DHCPACK on 10.1.1.101 to 08:00:27:db:ac:e3 via enp0s3
```

**☀️ Sur node1.lan1.tp2**
```
[slayz@node1lan1 ~]$ sudo dhclient enp0s3

[slayz@node1lan1 ~]$ ip a
1: lo: <LOOPBACK,UP,LOWER_UP> mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1000
    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00
    inet 127.0.0.1/8 scope host lo
       valid_lft forever preferred_lft forever
    inet6 ::1/128 scope host
       valid_lft forever preferred_lft forever
2: enp0s3: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc fq_codel state UP group default qlen 1000
    link/ether 08:00:27:db:ac:e3 brd ff:ff:ff:ff:ff:ff
    inet 10.1.1.100/24 brd 10.1.1.255 scope global dynamic noprefixroute enp0s3
       valid_lft 539sec preferred_lft 539sec

[slayz@node1lan1 ~]$ ip r s
default via 10.1.1.254 dev enp0s3
default via 10.1.2.254 dev enp0s3 proto static metric 100
default via 10.1.1.254 dev enp0s3 proto dhcp src 10.1.1.100 metric 100
10.1.1.0/24 dev enp0s3 proto kernel scope link src 10.1.1.100 metric 100
10.1.2.254 dev enp0s3 proto static scope link metric 100

[slayz@node1lan1 ~]$ ping 10.1.2.11
PING 10.1.2.11 (10.1.2.11) 56(84) bytes of data.
64 bytes from 10.1.2.11: icmp_seq=1 ttl=63 time=3.91 ms
64 bytes from 10.1.2.11: icmp_seq=2 ttl=63 time=3.74 ms
64 bytes from 10.1.2.11: icmp_seq=3 ttl=63 time=7.90 ms
^C
--- 10.1.2.11 ping statistics ---
3 packets transmitted, 3 received, 0% packet loss, time 2001ms
rtt min/avg/max/mdev = 3.738/5.184/7.902/1.923 ms
```
